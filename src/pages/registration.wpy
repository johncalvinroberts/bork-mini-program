<style lang="scss">
  @import '../styles/mixins.scss';
  .registration--title {
    @include titletext;
  }

  .registration--subtitle {
    @include subtitletext;
  }
</style>
<template>
  <view class="container padbox--default">
    <view class="registration--title">åŠ å…¥æˆ‘ä»¬</view>
    <view class="registration--subtitle">     æ¬¢è¿ä½ æ³¨å†Œfidoï¼Œåœ¨è¿™é‡Œæ‰¾çš„ä½ æƒ³é¢†å…»çš„ç‹—æˆ–è€…çŒ«ã€‚ä¸è¦å†å¯‚å¯ä¸‹å»ï¼Œå®ç°ä½ çš„æˆä¸ºå®¶é•¿çš„å¥½æ¢¦æƒ³
    </view>
    <formparent>
      <button class="btn--default__dark" disabled="{{wechatDisabled}}" @tap="getWeChat">
        <image class="icon--inline" src="../icons/wechat_white.svg" mode="aspectFit"></image>
        ä½¿ç”¨å¾®ä¿¡ç™»å½•
      </button>
      <block wx:if="{{authData}}">
        <view class="form-item--default">
          <view class="form-item--label">åå­—</view>
          <view class="form-item--input">{{authData.nickName}}</view>
        </view>
        <view class="form-item--default">
          <view class="form-item--label">åœ°æ–¹</view>
          <view class="form-item--input">{{authData.province}}, {{authData.city}}</view>
        </view>
        <view class="form-item--default">
          <view class="form-item--label">å¾®ä¿¡ğŸ‘Œ</view>
          <input type="text" placeholder="è¯·è¾“å…¥ä½ çš„å¾®ä¿¡å·" class="form-item--input" @input="handleWx"/>
        </view>
        <view class="form-message">
          æœ€åä¸€æ­¥ï¼šè®¤è¯ä¸€ä¸‹ä½ çš„è´¦å·ã€‚ä½ éœ€è¦ç»™æ•‘ç‹—äººå£«æä¾›ä½ çš„å¾®ä¿¡å·ï¼Œè¿™æ ·å­å½“ä½ é‡åˆ°å–œæ¬¢çš„ç‹—çš„æ—¶å€™æ•‘ç‹—äººå£«å¯ä»¥æ›´æ–¹ä¾¿çš„è”ç³»ä½ 
        </view>
        <view class="form-item--default">
          <view class="form-item--label__fullwidth">è‡ªæˆ‘ä»‹ç»</view>
          <textarea class="form-item--textinput" @input="handlePersonal"/>
        </view>
        <button class="btn--default btn--default__fixed">ä¿å­˜</button>
      </block>
    </formparent>
  </view>
  <view wx:if="{{isRegistered}}">
    <redirectmodal :message="message"/>
  </view>
</template>
<script>
  import wepy from 'wepy'
  import FormParent from '@/components/form-parent'
  import RedirectModal from '@/components/redirect-modal'
  export default class Registration extends wepy.page {
    config = {
      navigationBarTitleText: 'æ³¨å†Œ'
    }
    components = {
      formparent: FormParent,
      redirectmodal: RedirectModal
    }
    data = {
      message: 'ä½ å·²ç»æ³¨å†Œäº†',
      wechatDisabled: false,
      isRegistered: false,
      authData: null,
      wxUsername: {},
      personalNote: null
    }
    methods = {
      redirectHome () {
        wepy.navigateTo({url: 'landing'})
      },
      handleWx ({detail}) {
        this.wxUsername = detail.value
        this.$apply()
      },
      handlePersonal ({detail}) {
        console.log(detail)
        this.personalNote = detail.value
      }
    }

    computed = {}

    onShow () {
      this.isRegistered = !this.$parent.globalData.user.isRegistered
    }

    async getWeChat () {
      const user = this.$parent.globalData.user
      try {
        const authData = await user.authorize()
        console.log(authData)
        this.authData = authData
        this.$apply()
      } catch (err) {
        // actually deal with the error maybe lol
        console.error(err)
      }
    }
  }
  </script>
